<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facial Recognition Attendance</title>
    <style>
        body { background: #000; color: #fff; font-family: Arial, sans-serif; }
        .container { max-width: 500px; margin: 60px auto; padding: 30px; background: rgba(0,40,85,0.8); border-radius: 16px; box-shadow: 0 0 20px #222; text-align: center; }
        h2 { color: #ffcc00; }
        .btn { background-color: #ffcc00; color: #002855; border: none; padding: 10px 24px; border-radius: 6px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn:hover { background: #fff; color: #002855; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Mark Attendance with Face Recognition</h2>
        <video id="webcam" width="320" height="240" autoplay style="border-radius:10px; border:2px solid #ffcc00;"></video>
        <br>
        <button class="btn" onclick="captureAndSend()">Mark Attendance</button>
        <canvas id="snapshot" width="320" height="240" style="display:none;"></canvas>
        <div id="attendance-result" style="margin-top:10px;"></div>
    </div>
    <script>
        const video = document.getElementById('webcam');
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(function (stream) {
                    video.srcObject = stream;
                    video.play();
                })
                .catch(function (err) {
                    document.getElementById('attendance-result').innerText = 'Webcam access denied.';
                });
        } else {
            document.getElementById('attendance-result').innerText = 'Webcam not supported.';
        }
        function captureAndSend() {
            const canvas = document.getElementById('snapshot');
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, 320, 240);
            const imageData = canvas.toDataURL('image/png');
            document.getElementById('attendance-result').innerText = 'Processing...';
            fetch('/mark_attendance', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ image: imageData })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('attendance-result').innerText = 'Attendance marked for ' + data.name + '!';
                } else {
                    document.getElementById('attendance-result').innerText = 'Face not recognized. Try again.';
                }
            })
            .catch(() => {
                document.getElementById('attendance-result').innerText = 'Error connecting to server.';
            });
        }
    </script>
</body>
</html>
